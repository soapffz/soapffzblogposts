---
title: "CVE-2020-0796-Win-SMBGhost-RCE漏洞"
categories: [ "安全技术","工具分享" ]
tags: [ "漏洞利用","安全通告" ]
draft: false
slug: "528"
date: "2020-03-16 10:18:00"
---

## 0x01 简介

`SMB`(全称是 Server Message Block)是一个协议名，它能被用于 Web 连接和客户端与服务器之间的信息沟通。

![][1]

## 0x02 漏洞概述

漏洞名称：微软 SMBv3 Client/Server 远程代码执行漏洞 CVE-2020-0796

威胁等级：高危

漏洞类型：远程代码执行

该漏洞是由于 SMBv3 协议在处理恶意的压缩数据包时出错所造成的，它可让远程且未经身份验证的攻击者在目标系统上执行任意代码。该漏洞类似于永恒之蓝，存在被蠕虫化利用的可能。

## 0x03 影响版本

- 适用于 32 位系统的 Windows 10 版本 1903
- Windows 10 1903 版（用于基于 x64 的系统）
- Windows 10 1903 版（用于基于 ARM64 的系统）
- Windows Server 1903 版（服务器核心安装）
- 适用于 32 位系统的 Windows 10 版本 1909
- Windows 10 版本 1909（用于基于 x64 的系统）
- Windows 10 1909 版（用于基于 ARM64 的系统）
- Windows Server 版本 1909（服务器核心安装）

个人用户可用`win+r`输入`winver`查看自己当前`windows`版本：

![][2]

## 0x04 漏洞检测

[奇安信无损扫描器][3]：

![][4]

[Python 脚本][5]：

使用方法：

`python scanner.py <IP>`

![][6]

`Nmap`[检测脚本(nse 脚本)][7]

`nmap --script=CVE-2020-0796 <IP>`

![][8]

`Powershell`[检测脚本][9]

`windows`默认执行不受信任的`ps`脚本，因此需要设置`set-executionpolicy remotesigned`选择`Y`即可

![][10]

## 0x05 漏洞利用

提权的[`github`][11]

## 0x06 漏洞修复

1.腾讯电脑管家[`SMB漏洞修复工具`][12]

![][13]

2.安天`SMBv3`的`RCE`[漏洞强化工具][14]

![][15]

3.[微软官方补丁][16]

![][17]

4.禁用 SMBv3 压缩

如无法立即安装补丁，建议禁用 SMBv3 压缩

无需重启，可以防止远程命令执行，但无法防止针对 SMB 客户端的攻击

`powershell`:

```
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" DisableCompression -Type DWORD -Value 1 -Force
```

参考文章：

- [微软 SMBv3 Client/Server 远程代码执行漏洞安全风险通告（CVE-2020-0796）][18]
- [CVE-2020-0796，又是一场补丁攻坚战][19]
- [CVE-2020-0796：微软 SMBv3 协议 RCE 检测][20]
- [Win-SMBGhost-RCE 漏洞检测防御][21]
- [CVE-2020-0796: SMBv3 RCE vulnerability in SMBv3 (GhostSMB)][22]
- [更新：远程无损扫描工具公开发布| 微软 Windows SMBv3 服务远程代码执行漏洞（CVE-2020-0796）通告][23]
- [CVE-2020-0796 本地提权复现][24]
- [【更新】微软 SMBv3 Client/Server 远程代码执行漏洞深入分析（CVE-2020-0796）][25]

[1]: https://img.soapffz.com/archives_img/2020/03/16/archives_20200316_104338.png
[2]: https://img.soapffz.com/archives_img/2020/03/16/archives_20200316_102655.png
[3]: http://dl.qianxin.com/skylar6/CVE-2020-0796-Scanner.zip
[4]: https://img.soapffz.com/archives_img/2020/03/16/archives_20200328_202816.png
[5]: https://github.com/ollypwn/SMBGhost/blob/master/scanner.py
[6]: https://img.soapffz.com/archives_img/2020/03/16/archives_20200316_103329.png
[7]: https://github.com/cyberstruggle/DeltaGroup/blob/master/CVE-2020-0796/CVE-2020-0796.nse
[8]: https://img.soapffz.com/archives_img/2020/03/16/archives_20200316_110420.png
[9]: https://github.com/T13nn3s/CVE-2020-0976/blob/master/CVE-2020-0796-Smbv3-checker.ps1
[10]: https://img.soapffz.com/archives_img/2020/03/16/archives_20200316_105753.png
[11]: https://github.com/danigargu/CVE-2020-0796
[12]: http://dlied6.qq.com/invc/QQPatch/QuickFix_SMB0796.exe
[13]: https://img.soapffz.com/archives_img/2020/03/16/archives_20200316_102917.png
[14]: https://bbs.antiy.cn/forum.php?mod=viewthread&tid=83848
[15]: https://img.soapffz.com/archives_img/2020/03/16/archives_20200316_103125.png
[16]: https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-0796
[17]: https://img.soapffz.com/archives_img/2020/03/16/archives_20200316_104549.png
[18]: https://mp.weixin.qq.com/s/uGFdd8ahxAX96ieP02MBdA
[19]: https://mp.weixin.qq.com/s/4NtVFKJciQsxvbm2OyhEwA
[20]: https://mp.weixin.qq.com/s/msm9UNKq78sTrH8jKkDeKg
[21]: https://mp.weixin.qq.com/s/zTKRkObrUaHq-8eI2HQpDg
[22]: https://binsec.nl/cve-2020-0796-smbv3-rce-vulnerability-in-smbv3-coronablue/
[23]: https://mp.weixin.qq.com/s/VCEwb7PoHoj8_dbDrFap6w
[24]: https://mp.weixin.qq.com/s/e8rqliGdpMl6tR1-AV-7hQ
[25]: https://mp.weixin.qq.com/s/hhmDz9-37EBbL8mlgnLi4A